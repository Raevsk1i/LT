# LT
Load testing for Performance Lab

Методика - https://clck.ru/3BCrvv

Архитектура платформы Boomq
![Архитектура Boomq](https://github.com/Raevsk1i/LT/assets/150054332/a6463926-6bef-4dc4-809f-c2f8db02b5a8)



Boomq состоит из компонентов:
 - Frontend. Пользовательский интерфейс Boomq;
 - Telegraf on Docker. Агент для сбора метрик и данных о системе. Telegraf записывает собранные данные в TimescaleDB. Подробнее см. документацию Telegraf;
 - Proxy NGINX. Прокси-сервер, который обеспечивает взаимодействие Frontend и Backend Boomq. Подробнее см. документацию NGINX;
 - Микросервисы Boomq. Микросервисы, которые обеспечивают функциональные возможности Boomq;
 - MinIO. Файловое хранилище, в котором хранятся файлы, загружаемые пользователями, и
 - файлы, которые создаются по результатам тестов, например, лог-файлы. Подробнее см. документацию MinIO;
 - PostgreSQL. База данных, которая содержит тестовые проекты, настройки ипользователей. Подробнее см. документацию PostgreSQL;
 - Grafana. Инструмент для визуализации данных, полученных из TimescaleDB. Подробнее см. документацию Grafana;
 - TimescaleDB. База данных, которая содержит: системные метрики объекта тестирования; тестовые метрики, получаемые от JMeter; метрики нагрузочной станции, получаемые от Telegraf в контуре Boomq.
 - Экземпляров БД может быть несколько. Подробнее см. документацию TimescaleDB;
 - HAproxy. Прокси-сервер, который обеспечивает взаимодействие платформы Boomq и
 - TimescaleDB. Подробнее см. документацию HAproxy;
 - Patroni. Приложение для управления репликацией между экземплярами TimescaleDB. Устанавливается на каждом экземпляре TimescaleDB.
 - Patroni регистрирует в Consul экземпляр TimescaleDB и получает информацию о других экземплярах БД. HAproxy получает актуальный список экземпляров TimescaleDB изСonsul и данные о том, какие экземпляры поддерживает запись, а какие – чтение
 - Consul. Сервис, который регистрирует сервисы и экземпляры TimescaleDB, хранит настройки Boomq. Подробнее см. документацию Consul;
 - RabbitMQ. Менеджер очередей для асинхронного взаимодействия микросервисов. Подробнее см. документацию RabbitMQ;
 - Нагрузочная станция с Docker daemon. Подает нагрузку на объект тестирования.
 - Может устанавливаться на сервер с микросервисами или на отдельный сервер.
 - Нагрузочных станций может быть несколько. Станция включает в себя:
 - Docker c JMeter и Telegraf. Docker-контейнер, который включает JMeter и Telegraf. Подробнее см. документацию Docker


![image](https://github.com/Raevsk1i/LT/assets/150054332/5c44264c-10ba-43d2-bf9c-f183f5a59dae)
Подробнее см. документацию Patroni;
 - Consul. Сервис, который регистрирует сервисы и экземпляры TimescaleDB, хранит
настройки Boomq. Подробнее см. документацию Consul;

 - RabbitMQ. Менеджер очередей для асинхронного взаимодействия микросервисов.
Подробнее см. документацию RabbitMQ;

 - Нагрузочная станция с Docker daemon. Подает нагрузку на объект тестирования.
Может устанавливаться на сервер с микросервисами или на отдельный сервер.
Нагрузочных станций может быть несколько. Станция включает в себя:
    - Docker c JMeter и Telegraf. Docker-контейнер, который включает JMeter и Telegraf. Подробнее см. документацию Docker

Взаимодействие компонентов Boomq при
запуске теста
1. Пользователь в интерфейсе запускает тест, и с Frontend приходит запрос к
микросервисам.
2. Микросервисы проверяют, есть ли у пользователя права для запуска теста:
принадлежит ли пользователю проект, нет ли ограничений по лицензии.
3. Микросервисы обмениваются асинхронными сообщения через RabbitMQ и
дополнительно проверяют наличие прав у пользователя на запуск теста.
4. На нагрузочной станции разворачивается Docker-контейнер с JMeter.
5. Микросервисы из MinIO загружают в Docker-контейнер JMeter-скрипт для запуска теста
и при необходимости сопутствующие файлы.
6. Микросервисы запускают тест и передают данные об этом на Frontend.
7. JMeter отправляет:
запросы на объект тестирования;
тестовые метрики на TimescaleDB.
8. Telegraf отправляет метрики нагрузочной станции на TimescaleDB.
9. Если пользователь через интерфейс запрашивает детализацию выполнения теста:
a. Микросервисы отправляют запрос в Grafana.
b. Grafana получает данные о тесте и нагрузочной станции из TimescaleDB.
c. Если на объекте тестирования настроен Telegraf, то он отправляет данные в
TimescaleDB для системного мониторинга.
d. Grafana получает данные о метриках объекта тестирования.
10. Когда тест завершается:
a. Микросервисы подключаются к нагрузочной станции и выгружают с нее лог-файлы
в MinIO.
b. Если пользователь через интерфейс запрашивает лог-файлы, то микросервисы
формируют ссылку на лог-файл в MinIO и возвращают ее на Frontend.
